<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>ออเดอร์ทั้งหมด</title>
  <style>
    body { font-family: sans-serif; background-color: #f8f8f8; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; background: #fff; }
    th, td { border: 1px solid #aaa; padding: 6px; text-align: center; }
    th { background-color: #f2f2f2; }
    .order-box {
      border: 1px solid #ccc;
      margin: 15px auto;
      padding: 10px;
      border-radius: 8px;
      background-color: #fafafa;
      width: 90%;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    h3 { margin-top: 0; color: #333; }
    p { margin: 6px 0; }
    .btn-group { margin-top: 10px; text-align: center; }
    .btn {
      padding: 6px 14px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      color: white;
      font-weight: bold;
      margin: 0 5px;
    }
    .btn-accept { background-color: #22c55e; }
    .btn-accept:hover { background-color: #16a34a; }
    .btn-reject { background-color: #ef4444; }
    .btn-reject:hover { background-color: #dc2626; }
    .status {
      margin-top: 8px;
      font-weight: bold;
      text-align: center;
    }
  </style>
</head>
<body>
  <h2 style="text-align:center;">รายการออเดอร์</h2>
  <div id="ordersList"></div>
  <div style="text-align:center; margin-top:15px;">
    <a href="menu.html">กลับไปเมนู</a>
  </div>

  <script>
    let orders = JSON.parse(localStorage.getItem("orders")) || [];
    let ordersList = document.getElementById("ordersList");

    if (orders.length === 0) {
      ordersList.innerHTML = "<p style='text-align:center;'>ยังไม่มีออเดอร์</p>";
    } else {
      orders.slice().reverse().forEach((order, index) => {
        const realIndex = orders.length - 1 - index; // index จริงใน localStorage
        let div = document.createElement("div");
        div.className = "order-box";
        div.innerHTML = `<h3>ออเดอร์ #${orders.length - index} (${order.time})</h3>`;

        let table = "<table><tr><th>เมนู</th><th>จำนวน</th><th>ราคา</th></tr>";
        order.cart.forEach(item => {
          table += `<tr>
                      <td>${item.name}</td>
                      <td>${item.qty}</td>
                      <td>${item.price * item.qty}</td>
                    </tr>`;
        });
        table += "</table>";

        table += `
          <p><strong>รวม:</strong> ${order.totalQty} ไม้ | ${order.totalPrice} บาท</p>
          <p><strong>ระดับความเผ็ด:</strong> ${order.spicyLevel || "ไม่ระบุ"}</p>
        `;

        div.innerHTML += table;

        // ปุ่มรับหรือไม่รับออเดอร์
        const btnGroup = document.createElement("div");
        btnGroup.className = "btn-group";
        btnGroup.innerHTML = `
          <button class="btn btn-accept" onclick="updateStatus(${realIndex}, 'รับออเดอร์แล้ว')">รับออเดอร์</button>
          <button class="btn btn-reject" onclick="updateStatus(${realIndex}, 'ไม่รับออเดอร์')">ไม่รับออเดอร์</button>
        `;
        div.appendChild(btnGroup);

        // สถานะออเดอร์
        const status = document.createElement("div");
        status.className = "status";
        status.id = "status-" + realIndex;
        status.textContent = "สถานะ: " + (order.status || "รอดำเนินการ");
        div.appendChild(status);

        ordersList.appendChild(div);
      });
    }

    function updateStatus(index, statusText) {
      let orders = JSON.parse(localStorage.getItem("orders")) || [];
      orders[index].status = statusText;
      localStorage.setItem("orders", JSON.stringify(orders));

      const statusDiv = document.getElementById("status-" + index);
      statusDiv.textContent = "สถานะ: " + statusText;
      alert("อัปเดตสถานะเป็น '" + statusText + "' แล้ว");
    }
  </script>
</body>
</html>
